# 15. Development of an assessment function (in Japanese)

14節の続き． **あなたのいいところ診断** のJavaScript部分を実装する．

## 学習メモ

### 実装の流れ (再掲)

1. `html`, `css`, `js`ファイルと雛形を作成する．
2. モックアップで作成した要素(見た目, **UI** )をHTMLに記述する．
3. CSSでスタイルを設定する．
4. 名前の入力と結果を返す部分をJavaScriptで作成する．(今回はここから)
5. 実装したJavaScriptのテストコードを書いて，動作を検証する．
6. 細かいコードの修正を行う．(16節参照)

### 診断機能の要件

1. 診断結果のパターンを纏めたデータから，適当な結果を取得できる
2. 名前を入力すると結果を出力できる(関数)
    1. 同一名の入力の場合，同じ診断結果を出力する
    2. 診断結果の文章に，入力された名前を反映させる処理


### [手順4] 名前の入力と結果を返す部分を作成する
1. `Array`(配列)に，診断結果のパターンデータを作成する
    - 一度設定したら改変できないように，`const`型を指定．
2. 入出力関数を実装する
    - 入力名の各文字をコード番号(数値)に変換し，全文字列の合計値を計算
    - 入力名ごとに，診断結果パターン配列のインデックス値を割り振る
        - 例 `インデックス値 = 全文字列の合計値 / 診断結果パターンのデータ数`
    - 正規表現で{ユーザ名}の部分を入力された名前に置き換える
  
#### マルチカーソル機能

診断結果のパターンデータを作成した時，一つ一つ配列の要素に整形(`''`や`,`を付ける)するのは，とても面倒くさい．

そんなとき，カーソル数をデータ数分だけ増やすことができる **マルチカーソル** 機能を使うと良い．

使い方:<br>
- カーソルを増やす
    - Windows `Ctrl`+`Alt`+`↓`or`↑`
    - Mac `Command`+`Alt`+`↓`or`↑`
    - カーソル数を減らす場合は，減らしたい方向に上のコマンドを使う．
- カーソルを，文末にセットする．
    - Windows `End`
    - Mac `Command`+`→` 


#### JsDocとインターフェース

関数の上などにコマンドを書くときの形式．[JsDoc](http://usejsdoc.org/)に従うことで，インターフェースの定義をわかりやすくコメントできる．

例:

```javascript
    /**
    * 名前の文字列 -> 診断結果
    * @param {string} userName ユーザ名
    * @return {string} 診断結果
    */
    function assess(userName) {
        // TODO 診断処理を実装
        return '';
    }
```

- `@param` 引数
- `@return` 戻り値
- `{型}` ここでは`string`をとることが示されている．
- `@param {型} 関数名`という形式で記述する．
 
#### 文字からコード番号を取得する

`'文字列'.charCodeAt(文字列のインデックス)`で取得可能．

あとは，文字長分`for`ループを回して，文字列のコード番号合計値を取得すれば良い．

#### 正規表現で{ユーザ名}を置換する

1. `/文字列/`で囲む．
2. `{`と`}`は置換対象でないので，`\`を使ってエスケープ処理する．
3. グローバル修飾子\*`g`を末尾に付けて，全てのマッチング箇所を検索する．
4. `replace`関数で置換処理を実装する．

例:

```javascript
result = result.replace(/\{userName\}/g, userName);
```
`{}`で囲まれた`userName`を，replace関数の第二引数`userName`の変数値に置換している．

\* マッチングの処理方法を指定するオプション<br>
例 `i`: ignoreCase(大文字小文字を区別しない)

### [手順5] テストコードを書いて動作を検証する

#### なぜテストコードを書くのか？

ログ出力を目視で確認しても，見落としや見間違いが起きうるから．

正規表現で文章中の`{userName}`が全て`太郎`と置換されるべきところ，一箇所だけ`次郎`と置換されてしまった場合，その間違いに気づけますか？

#### JavaScriptで単体テスト

`console.assert`関数で行うことができる．

```javascript
console.assert(
    example(hoge) === sampleVar,
    'テスト結果が正しくなかったときに出力されるメッセージ'
)
```

のように記述する．

例:<br>
今回の場合は，`assert`関数内で`asssessment`の戻り値が，正しく入力した名前に置換されているか確認するので,

- `assessment('太郎') === '太郎のいいところはニート力です。太郎は自宅をしっかり警備できる人材です．'`
- `assessment('太郎') === '太郎のいいところはニート力。三郎は自宅をしっかり警備できる人材です．'`

というふうに検証したい部分の値を変えて`html`ファイルを開く．テストが通っているかデベロッパーツールの`console`で確認する．

## 練習問題

**入力が同一名の場合，同じ診断結果を返す** 部分が正しく動作するかを検証するテストコードを書いてみよ．

### 答案

`./assessment/assessment.js`にある．

コード内容:

```javascript
    // 抜粋
    console.assert(
        assessment('太郎') === assessment('太郎'),
        '入力が同一の名前なら，同じ診断結果を出力する処理が正しくありません．'
    );
```

### 模範解答との比較

考え方に相違ない．正解．

## 感想

マルチカーソル機能

- カーソル増やす `Command`+`Alt`+`↓`
- 全カーソルを文末にセッティングする `command`+`→`

を知らなかった．これめっちゃ凄くて感動！